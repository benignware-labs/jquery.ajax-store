!function(a){function b(b,c){var d;return d||c&&"xml"!==c||(d=a.parseXML(b)),d||c&&"json"!==c||(d=a.parseJSON(b)),d}function c(b){"string"==typeof b&&(b={type:b});var c=a.extend(!0,{},g,b);return c}function d(b,c){var d=a.ajax(a.extend({},b,{type:"HEAD",success:function(a){var b=new Date(d.getResponseHeader("Last-Modified")).getTime();c(b)},error:function(){c(null)}}))}function e(a,b){var c=k[a.type]?new k[a.type]:null,d="function"==typeof a.expires?a.expires:function(a){return"boolean"==typeof a.expires?a.expires:a.updated<(new Date).getTime()-a.expires};c?c.select(d,function(a){var d=function(){var e=a.shift();e?c.set(e,null,d):b()};d()}):b()}function f(a,b,c){if(!a)return void c(!1);var e=b.store.validate;return"boolean"==typeof e&&e===!1?void c(!0):(e="function"==typeof e&&e||function(a,b,c){d(b,function(b){c(b<a.updated)})},void e(a,b,c))}var g={type:"memory",expires:!1,validate:!1},h=function(){var a={};return function(b){b="object"==typeof b&&b||{},b.store=b.store||"ajax-store",a[b.store]=a[b.store]||{},this.get=function(c,d){var e=a[b.store],f=e[c]&&(!b.expire||e[c].timestamp>(new Date).getTime()-b.expire)&&e[c].value;d&&d.call(this,f)},this.set=function(c,d,e){var f=a[b.store];f[c]={value:d,timestamp:(new Date).getTime()},e&&e.call(this)},this.select=function(c,d){var e=a[b.store],f=[];for(var g in e)!e[g]||c&&!c(e[g])||f.push(g);d(f)}}}(),i=function(){return function(a){a="object"==typeof a&&a||{},a.store=a.store||"ajax-store",this.get=function(b,c){var d=JSON.parse(localStorage.getItem(a.store))||{};c.call(this,d[b])},this.set=function(b,c,d){var e=JSON.parse(localStorage.getItem(a.store))||{};null===c||void 0===c?delete e[b]:e[b]=c,localStorage.setItem(a.store,JSON.stringify(e)),d()},this.select=function(b,c){var d=JSON.parse(localStorage.getItem(a.store))||{},e=[];for(var f in d)!d[f]||b&&!b(d[f])||e.push(f);c(e)}}}(),j=function(){return function(a){a="object"==typeof a&&a||{},a.store=a.store||"ajax-store";var b,c=a.database||"ajax-store",d="key",e=1,f=function(f){if(b)f(b);else{var g=indexedDB.open(c,e);g.onupgradeneeded=function(c){b=c.target.result,c.target.transaction.onerror=function(){deferred.reject()},b.objectStoreNames.contains(a.store)&&b.deleteObjectStore(a.store),b.createObjectStore(a.store,{keyPath:d})},g.onsuccess=function(a){b=a.target.result,f(b)},g.onblocked=g.onerror=function(a){f(!1)}}};this.get=function(b,c){f(function(d){var e=d.transaction([a.store]),f=e.objectStore(a.store),g=f.get(b);g.onerror=function(a){c(!1)},g.onsuccess=function(a){c(g.result&&g.result.data||null)}})},this.set=function(b,c,e){f(function(f){var g,h=f.transaction([a.store],"readwrite"),i=h.objectStore(a.store);if(null===c){var j=i.openCursor();j.onerror=function(a){e(!1)},j.onsuccess=function(a){var c=a.target.result;if(c){if(c.value[d]===b){var e=c["delete"]();e.onsuccess=function(a){},e.onerror=function(){}}c["continue"]()}}}else{var k={};k[d]=b,k.data=c,g=i.put(k),g.onerror=function(){e(!1)}}h.oncomplete=function(){e(!0)}})},this.select=function(b,c){f(function(e){var f=e.transaction(a.store,IDBTransaction.READ_ONLY),g=f.objectStore(a.store),h=[];f.oncomplete=function(a){c(h)};var i=g.openCursor();i.onerror=function(a){c(!1)},i.onsuccess=function(a){var c=a.target.result;if(c){var e=b(c.value.data);e&&h.push(c.value[d]),c["continue"]()}}})}}}(),k={memory:h,localstorage:i,indexedDB:j};a.ajaxTransport("+*",function(d,g,h){if(d=a.extend({},d),"GET"===d.type&&d.store&&(d.store=c(d.store),k[d.store.type.toLowerCase()])){var i=new(k[d.store.type.toLowerCase()]),j=!1;return{send:function(c,g){if(!j){var k=d.url;e(d.store,function(){i.get(k,function(c){f(c,d,function(e){if(!j)if(e){b(c.value,d.dataType);g(200,"Ok",{text:c.value})}else h=a.ajax(a.extend({},d,{store:!1,success:function(a){var b={};b[d.dataType]=a,i.set(k,{value:h.responseText,updated:(new Date).getTime(),expires:d.store.expires},function(){g(h.status,h.statusText,b,h.getAllResponseHeaders())})},error:function(){j||g(h.status,h.statusText,{})}}))})})})}},abort:function(){j=!0,h&&h.abort()}}}})}(jQuery);